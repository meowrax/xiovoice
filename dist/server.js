const _0x23c90a=_0x2df4;function _0x2df4(_0x58f6ff,_0x1a81a8){const _0x573377=_0x5733();return _0x2df4=function(_0x2df445,_0x3bf365){_0x2df445=_0x2df445-0xc9;let _0x500da0=_0x573377[_0x2df445];return _0x500da0;},_0x2df4(_0x58f6ff,_0x1a81a8);}(function(_0xdcd9b2,_0x1b3235){const _0x185db9=_0x2df4,_0x2064f4=_0xdcd9b2();while(!![]){try{const _0x3461cb=-parseInt(_0x185db9(0x10a))/0x1*(parseInt(_0x185db9(0xd8))/0x2)+-parseInt(_0x185db9(0xc9))/0x3+-parseInt(_0x185db9(0x105))/0x4*(parseInt(_0x185db9(0xd6))/0x5)+-parseInt(_0x185db9(0x11d))/0x6*(parseInt(_0x185db9(0xe6))/0x7)+parseInt(_0x185db9(0xe8))/0x8+parseInt(_0x185db9(0xca))/0x9*(parseInt(_0x185db9(0xf3))/0xa)+parseInt(_0x185db9(0x12f))/0xb;if(_0x3461cb===_0x1b3235)break;else _0x2064f4['push'](_0x2064f4['shift']());}catch(_0x3a758f){_0x2064f4['push'](_0x2064f4['shift']());}}}(_0x5733,0x9fc47));const express=require(_0x23c90a(0x13e)),http=require('http'),WebSocket=require('ws'),{v4:uuidv4}=require(_0x23c90a(0x135)),path=require(_0x23c90a(0x113)),app=express(),server=http[_0x23c90a(0x129)](app),wss=new WebSocket['Server']({'server':server}),rooms=new Map(),clients=new Map(),rateLimit=new Map(),RATE_LIMIT_WINDOW=0xea60,RATE_LIMIT_MAX_REQUESTS=0x3,MAX_ROOMS=0x5,EMPTY_ROOM_TIMEOUT=0x927c0,csrfTokens=new Map(),CSRF_TOKEN_LIFETIME=0x493e0,suspiciousIPs=new Set(),ERR={'E001':_0x23c90a(0x10d),'E002':_0x23c90a(0xe4),'E003':_0x23c90a(0x126),'E004':_0x23c90a(0x10c),'E005':'7b6a5f4e-3d2c-1b0a-9f8e-7d6c5b4a3f2e','E006':'2e1d0c9b-8a7f-6e5d-4c3b-2a1f0e9d8c7b'};function getClientIP(_0x2ecbca){const _0x43a6ed=_0x23c90a;return _0x2ecbca[_0x43a6ed(0x128)]['cf-connecting-ip']||_0x2ecbca[_0x43a6ed(0x128)][_0x43a6ed(0x12b)]?.[_0x43a6ed(0x106)](',')[0x0]||_0x2ecbca[_0x43a6ed(0x128)][_0x43a6ed(0x134)]||_0x2ecbca['connection'][_0x43a6ed(0x13d)]||_0x2ecbca[_0x43a6ed(0x103)][_0x43a6ed(0x13d)]||_0x43a6ed(0x142);}function checkRateLimit(_0x3bcc98){const _0x490735=_0x23c90a;if(suspiciousIPs['has'](_0x3bcc98))return!0x1;const _0x5864ba=Date['now'](),_0x755b22=rateLimit[_0x490735(0x133)](_0x3bcc98);return _0x755b22?_0x5864ba>_0x755b22[_0x490735(0xf4)]?(rateLimit[_0x490735(0xe9)](_0x3bcc98,{'count':0x1,'resetTime':_0x5864ba+0xea60}),!0x0):_0x755b22['count']>=0x3?(suspiciousIPs[_0x490735(0xd1)](_0x3bcc98),setTimeout(()=>suspiciousIPs[_0x490735(0x132)](_0x3bcc98),0x36ee80),!0x1):(_0x755b22[_0x490735(0xe3)]++,!0x0):(rateLimit[_0x490735(0xe9)](_0x3bcc98,{'count':0x1,'resetTime':_0x5864ba+0xea60}),!0x0);}function isValidRequest(_0x3df00d){const _0x2c7e66=_0x23c90a,_0x3f2ba1=_0x3df00d['headers'][_0x2c7e66(0x108)]||'',_0x133029=_0x3df00d[_0x2c7e66(0x128)]['origin']||'',_0x5241fa=_0x3df00d[_0x2c7e66(0x128)][_0x2c7e66(0x125)]||'',_0x396063=_0x3df00d[_0x2c7e66(0x128)]['sec-fetch-mode']||'',_0x51532c=[_0x2c7e66(0xfa),_0x2c7e66(0x109),'Safari','Firefox',_0x2c7e66(0x101),'Opera'][_0x2c7e66(0xe7)](_0x18285f=>_0x3f2ba1[_0x2c7e66(0xe5)](_0x18285f)),_0x5afb03=_0x133029[_0x2c7e66(0xe5)](_0x2c7e66(0xdd))||_0x133029[_0x2c7e66(0xe5)](_0x2c7e66(0xfb));return _0x51532c&&_0x5afb03&&(_0x2c7e66(0x13f)===_0x5241fa&&_0x2c7e66(0x100)===_0x396063);}function broadcast(_0x78746,_0x5829be,_0x5845a0=null){const _0x227409=_0x23c90a,_0x32741b=rooms[_0x227409(0x133)](_0x78746);_0x32741b&&_0x32741b[_0x227409(0xe1)][_0x227409(0x10f)]((_0x556afb,_0x2ca66a)=>{const _0x284ec1=_0x227409;if(_0x5845a0&&_0x2ca66a===_0x5845a0)return;const _0x2cf97c=clients[_0x284ec1(0x133)](_0x2ca66a);_0x2cf97c&&_0x2cf97c['ws'][_0x284ec1(0x130)]===WebSocket['OPEN']&&_0x2cf97c['ws'][_0x284ec1(0x110)](JSON[_0x284ec1(0xfe)](_0x5829be));});}function sendToClient(_0x56515c,_0x268379){const _0x306e62=_0x23c90a,_0x5bac0a=clients[_0x306e62(0x133)](_0x56515c);_0x5bac0a&&_0x5bac0a['ws']['readyState']===WebSocket['OPEN']&&_0x5bac0a['ws'][_0x306e62(0x110)](JSON[_0x306e62(0xfe)](_0x268379));}function handleMessage(_0x2e460f,_0x49a414){const _0x15399=_0x23c90a,_0x712525=clients[_0x15399(0x133)](_0x2e460f);if(_0x712525)switch(_0x49a414[_0x15399(0xef)]){case _0x15399(0x144):{const {roomId:_0x5a10f3,nickname:_0x302ac1}=_0x49a414,_0x48d2f9=rooms[_0x15399(0x133)](_0x5a10f3);if(!_0x48d2f9)return void sendToClient(_0x2e460f,{'type':_0x15399(0xcb),'message':_0x15399(0x12e)});const _0x240b03=uuidv4()[_0x15399(0x143)](0x0,0x8);_0x712525[_0x15399(0x107)]=_0x5a10f3,_0x712525[_0x15399(0x11e)]=_0x302ac1,_0x712525[_0x15399(0xd7)]=_0x240b03,_0x48d2f9['participants'][_0x15399(0xe9)](_0x2e460f,{'id':_0x2e460f,'nickname':_0x302ac1,'userKey':_0x240b03,'joinedAt':Date[_0x15399(0xdf)](),'isMuted':!0x1,'isDeafened':!0x1,'isScreenSharing':!0x1,'avatar':null}),_0x48d2f9['lastEmptyTime']=null,sendToClient(_0x2e460f,{'type':_0x15399(0x122),'roomId':_0x5a10f3,'userKey':_0x240b03,'participants':Array['from'](_0x48d2f9[_0x15399(0xe1)][_0x15399(0xcc)]()),'messages':_0x48d2f9['messages'][_0x15399(0x143)](-0x32)}),broadcast(_0x5a10f3,{'type':_0x15399(0x127),'user':{'id':_0x2e460f,'nickname':_0x302ac1,'userKey':_0x240b03}},_0x2e460f),broadcast(_0x5a10f3,{'type':_0x15399(0xd9),'participants':Array[_0x15399(0x13c)](_0x48d2f9['participants'][_0x15399(0xcc)]())});break;}case _0x15399(0xde):{const {roomId:_0x459cce,content:_0x1313ff,image:_0x221a54}=_0x49a414,_0x1bb2ef=rooms[_0x15399(0x133)](_0x459cce);if(!_0x1bb2ef)return;const _0x43156f={'id':uuidv4(),'senderId':_0x2e460f,'senderName':_0x712525[_0x15399(0x11e)],'content':_0x1313ff,'image':_0x221a54,'timestamp':Date[_0x15399(0xdf)]()};_0x1bb2ef[_0x15399(0x11b)][_0x15399(0xf8)](_0x43156f),_0x1bb2ef[_0x15399(0x11b)][_0x15399(0xf6)]>0xc8&&(_0x1bb2ef[_0x15399(0x11b)]=_0x1bb2ef['messages'][_0x15399(0x143)](-0x64)),broadcast(_0x459cce,{'type':_0x15399(0xde),'message':_0x43156f});break;}case _0x15399(0xf9):{const {targetId:_0x11c77f,offer:_0x18cfaa}=_0x49a414;sendToClient(_0x11c77f,{'type':'webrtc-offer','senderId':_0x2e460f,'senderName':_0x712525[_0x15399(0x11e)],'offer':_0x18cfaa});break;}case _0x15399(0xec):{const {targetId:_0x7bd1df,answer:_0x5ec02c}=_0x49a414;sendToClient(_0x7bd1df,{'type':_0x15399(0xec),'senderId':_0x2e460f,'answer':_0x5ec02c});break;}case _0x15399(0xfc):{const {targetId:_0x76e2b2,candidate:_0x341636}=_0x49a414;sendToClient(_0x76e2b2,{'type':_0x15399(0xfc),'senderId':_0x2e460f,'candidate':_0x341636});break;}case _0x15399(0x139):{const _0x597524=rooms['get'](_0x712525[_0x15399(0x107)]);if(!_0x597524)return;const _0x49dc23=_0x597524['participants'][_0x15399(0x133)](_0x2e460f);_0x49dc23&&(_0x49dc23[_0x15399(0xda)]=_0x49a414[_0x15399(0xda)],broadcast(_0x712525[_0x15399(0x107)],{'type':_0x15399(0xeb),'clientId':_0x2e460f,'isMuted':_0x49a414[_0x15399(0xda)]}));break;}case _0x15399(0xcd):{const _0xef14ac=rooms[_0x15399(0x133)](_0x712525[_0x15399(0x107)]);if(!_0xef14ac)return;const _0x5eefc4=_0xef14ac[_0x15399(0xe1)][_0x15399(0x133)](_0x2e460f);_0x5eefc4&&(_0x5eefc4[_0x15399(0xf2)]=_0x49a414[_0x15399(0xf2)],broadcast(_0x712525[_0x15399(0x107)],{'type':_0x15399(0x118),'clientId':_0x2e460f,'avatar':_0x49a414[_0x15399(0xf2)]}));break;}case'toggle-deafen':{const _0x5a9267=rooms[_0x15399(0x133)](_0x712525['roomId']);if(!_0x5a9267)return;const _0x2df878=_0x5a9267[_0x15399(0xe1)][_0x15399(0x133)](_0x2e460f);_0x2df878&&(_0x2df878[_0x15399(0xcf)]=_0x49a414['isDeafened'],broadcast(_0x712525['roomId'],{'type':_0x15399(0x119),'clientId':_0x2e460f,'isDeafened':_0x49a414[_0x15399(0xcf)]}));break;}case _0x15399(0xdb):{const _0x272b6c=rooms[_0x15399(0x133)](_0x712525['roomId']);if(!_0x272b6c)return;const _0x59b33e=_0x272b6c[_0x15399(0xe1)]['get'](_0x2e460f);_0x59b33e&&(_0x59b33e[_0x15399(0xf0)]=!0x0,broadcast(_0x712525['roomId'],{'type':'screen-share-started','clientId':_0x2e460f,'nickname':_0x712525[_0x15399(0x11e)]}));break;}case _0x15399(0x141):{const _0x573be8=rooms[_0x15399(0x133)](_0x712525[_0x15399(0x107)]);if(!_0x573be8)return;const _0x31c1a0=_0x573be8['participants'][_0x15399(0x133)](_0x2e460f);_0x31c1a0&&(_0x31c1a0[_0x15399(0xf0)]=!0x1,broadcast(_0x712525[_0x15399(0x107)],{'type':_0x15399(0x141),'clientId':_0x2e460f}));break;}case _0x15399(0x11c):{const {targetId:_0x2b78b2}=_0x49a414;sendToClient(_0x2b78b2,{'type':_0x15399(0x137),'requesterId':_0x2e460f});break;}}}setInterval(()=>{const _0x3c1ca5=_0x23c90a,_0x93f58f=Date['now']();for(const [_0x2223c3,_0x24b252]of rateLimit[_0x3c1ca5(0x131)]())_0x93f58f>_0x24b252[_0x3c1ca5(0xf4)]&&rateLimit[_0x3c1ca5(0x132)](_0x2223c3);},0xea60),app[_0x23c90a(0xe9)](_0x23c90a(0x114),!0x0),app[_0x23c90a(0x10b)](express[_0x23c90a(0x12d)](path[_0x23c90a(0x115)](__dirname,_0x23c90a(0x111)))),app[_0x23c90a(0x10b)](express[_0x23c90a(0x13a)]({'limit':_0x23c90a(0x124)})),app[_0x23c90a(0x133)]('/',(_0xc5c934,_0x3c0e68)=>{const _0x48aeaf=_0x23c90a;_0x3c0e68[_0x48aeaf(0x136)](path[_0x48aeaf(0x115)](__dirname,'public','index.html'));}),app[_0x23c90a(0x133)](_0x23c90a(0x12a),(_0x45831c,_0x2a2e88)=>{const _0x2858df=_0x23c90a;_0x2a2e88['sendFile'](path[_0x2858df(0x115)](__dirname,_0x2858df(0x111),_0x2858df(0xe0)));}),app[_0x23c90a(0x133)](_0x23c90a(0xf7),(_0xbe93a1,_0x201b4a)=>{const _0x5ccd94=_0x23c90a,_0x174579=uuidv4(),_0x182c44=getClientIP(_0xbe93a1);csrfTokens[_0x5ccd94(0xe9)](_0x174579,{'ip':_0x182c44,'createdAt':Date[_0x5ccd94(0xdf)]()}),setTimeout(()=>csrfTokens['delete'](_0x174579),0x493e0),_0x201b4a[_0x5ccd94(0x13a)]({'d':_0x174579});}),app[_0x23c90a(0x116)](_0x23c90a(0x104),(_0x2059c2,_0x400ade)=>{const _0x19f3ff=_0x23c90a,_0x3c6721=getClientIP(_0x2059c2),_0xe18f42=_0x2059c2[_0x19f3ff(0x128)][_0x19f3ff(0x13b)];if(!_0xe18f42||!csrfTokens['has'](_0xe18f42))return _0x400ade['status'](0x193)['json']({'c':ERR[_0x19f3ff(0xea)]});const _0xb532f0=csrfTokens[_0x19f3ff(0x133)](_0xe18f42);csrfTokens[_0x19f3ff(0x132)](_0xe18f42);const _0x91ce16=Date[_0x19f3ff(0xdf)]()-_0xb532f0[_0x19f3ff(0xee)];if(_0x91ce16>0x493e0)return _0x400ade[_0x19f3ff(0xf5)](0x193)[_0x19f3ff(0x13a)]({'c':ERR[_0x19f3ff(0x12c)]});if(_0x91ce16<0x3e8)return suspiciousIPs['add'](_0x3c6721),_0x400ade[_0x19f3ff(0xf5)](0x193)[_0x19f3ff(0x13a)]({'c':ERR[_0x19f3ff(0x123)]});if(!isValidRequest(_0x2059c2))return suspiciousIPs[_0x19f3ff(0xd1)](_0x3c6721),_0x400ade[_0x19f3ff(0xf5)](0x193)[_0x19f3ff(0x13a)]({'c':ERR[_0x19f3ff(0xd4)]});if(!checkRateLimit(_0x3c6721))return _0x400ade['status'](0x1ad)[_0x19f3ff(0x13a)]({'c':ERR[_0x19f3ff(0xd5)]});if(rooms[_0x19f3ff(0x10e)]>=0x5)return _0x400ade[_0x19f3ff(0xf5)](0x1f7)[_0x19f3ff(0x13a)]({'c':ERR[_0x19f3ff(0x117)],'limit':!0x0});const _0x505828=uuidv4()['slice'](0x0,0x8),_0x45bc3b=uuidv4()[_0x19f3ff(0x143)](0x0,0xc);rooms[_0x19f3ff(0xe9)](_0x505828,{'id':_0x505828,'adminKey':_0x45bc3b,'createdAt':Date[_0x19f3ff(0xdf)](),'lastEmptyTime':Date[_0x19f3ff(0xdf)](),'participants':new Map(),'messages':[]}),_0x400ade[_0x19f3ff(0x13a)]({'r':_0x505828,'k':_0x45bc3b,'l':_0x19f3ff(0xd0)+_0x505828});}),app['get'](_0x23c90a(0xfd),(_0x320bad,_0x22f09f)=>{const _0xeb74fc=_0x23c90a,_0x25085a=rooms[_0xeb74fc(0x133)](_0x320bad[_0xeb74fc(0x112)][_0xeb74fc(0x107)]);if(!_0x25085a)return _0x22f09f[_0xeb74fc(0xf5)](0x194)['json']({'c':0x0});_0x22f09f[_0xeb74fc(0x13a)]({'e':0x1,'p':_0x25085a[_0xeb74fc(0xe1)][_0xeb74fc(0x10e)]});}),wss['on'](_0x23c90a(0xf1),_0x31349c=>{const _0x5b1528=_0x23c90a,_0x51187d=uuidv4();clients['set'](_0x51187d,{'ws':_0x31349c,'roomId':null,'nickname':null,'odId':null}),_0x31349c[_0x5b1528(0x110)](JSON['stringify']({'type':_0x5b1528(0x120),'clientId':_0x51187d})),_0x31349c['on'](_0x5b1528(0x140),_0x23d9d0=>{const _0x1a6ab6=_0x5b1528;try{const _0x20de06=JSON[_0x1a6ab6(0x138)](_0x23d9d0);handleMessage(_0x51187d,_0x20de06);}catch(_0x48207d){console[_0x1a6ab6(0xcb)](_0x1a6ab6(0xe2),_0x48207d);}}),_0x31349c['on'](_0x5b1528(0xff),()=>{const _0x19983d=_0x5b1528,_0x267d1e=clients['get'](_0x51187d);if(_0x267d1e&&_0x267d1e['roomId']){const _0x1f4823=rooms['get'](_0x267d1e[_0x19983d(0x107)]);_0x1f4823&&(_0x1f4823[_0x19983d(0xe1)]['delete'](_0x51187d),0x0===_0x1f4823['participants'][_0x19983d(0x10e)]&&(_0x1f4823['lastEmptyTime']=Date['now']()),broadcast(_0x267d1e[_0x19983d(0x107)],{'type':_0x19983d(0xd2),'clientId':_0x51187d,'nickname':_0x267d1e[_0x19983d(0x11e)]}),broadcast(_0x267d1e[_0x19983d(0x107)],{'type':_0x19983d(0xd9),'participants':Array[_0x19983d(0x13c)](_0x1f4823[_0x19983d(0xe1)][_0x19983d(0xcc)]())}));}clients['delete'](_0x51187d);});}),setInterval(()=>{const _0x2b5319=_0x23c90a,_0x3f74c2=Date[_0x2b5319(0xdf)]();rooms['forEach']((_0x4d592b,_0x33eaaa)=>{const _0x609e59=_0x2b5319;0x0===_0x4d592b[_0x609e59(0xe1)]['size']&&_0x4d592b[_0x609e59(0xce)]&&_0x3f74c2-_0x4d592b['lastEmptyTime']>0x927c0&&(rooms[_0x609e59(0x132)](_0x33eaaa),console['log'](_0x609e59(0x11f)+_0x33eaaa+_0x609e59(0xdc)));});},0xea60);const PORT=process[_0x23c90a(0x11a)][_0x23c90a(0xd3)]||0xbb8;server[_0x23c90a(0x102)](PORT,()=>{const _0x4ceab2=_0x23c90a;console[_0x4ceab2(0x121)](_0x4ceab2(0xed)+PORT);});function _0x5733(){const _0x16622f=['stringify','close','cors','Edge','listen','socket','/x/c','2842976yRYPjw','split','roomId','user-agent','Chrome','858239XUyTSA','use','f4e3d2c1-b0a9-8f7e-6d5c-4b3a2f1e0d9c','d107fc57-3a5d-49c6-95e4-b5648000dc17','size','forEach','send','public','params','path','trust\x20proxy','join','post','E006','user-avatar-changed','user-deafen-changed','env','messages','request-screen','120uLwAYE','nickname','Room\x20','connected','log','joined','E003','50mb','sec-fetch-site','9c8b7a6f-5e4d-3c2b-1a0f-e9d8c7b6a5f4','user-joined','headers','createServer','/room/:roomId','x-forwarded-for','E002','static','Комната\x20не\x20найдена','28095122SxtjVk','readyState','entries','delete','get','x-real-ip','uuid','sendFile','screen-requested','parse','toggle-mute','json','x-t','from','remoteAddress','express','same-origin','message','screen-share-stopped','unknown','slice','join-room','3534387iwWUvV','4749588eDqzXf','error','values','update-avatar','lastEmptyTime','isDeafened','/room/','add','user-left','PORT','E004','E005','5jaDtEN','userKey','2OIoxuV','participants-update','isMuted','screen-share-started','\x20deleted\x20(empty\x20for\x2010\x20minutes)','xiovoice.onrender.com','chat-message','now','index.html','participants','Failed\x20to\x20parse\x20message:','count','a3f8b2c1-7e4d-4a9f-8c6b-2d1e5f3a7b9c','includes','322245kIvQoa','some','9923080zegVjU','set','E001','user-mute-changed','webrtc-answer','Server\x20running\x20on\x20http://localhost:','createdAt','type','isScreenSharing','connection','avatar','10PqpNVc','resetTime','status','length','/x/t','push','webrtc-offer','Mozilla','localhost','webrtc-ice-candidate','/x/r/:roomId'];_0x5733=function(){return _0x16622f;};return _0x5733();}