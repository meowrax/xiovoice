const _0x1580fd=_0x11fc;function _0x3bf9(){const _0x100c41=['chat-message','E003','user-avatar-changed','listen','x-forwarded-for','sec-fetch-mode','delete','json','2e1d0c9b-8a7f-6e5d-4c3b-2a1f0e9d8c7b','240805PRIRPI','Edge','68hmIAgb','send','5795250VTjgdg','createServer','count','log','E004','isDeafened','participants','126beGytF','Server','E002','webrtc-answer','d107fc57-3a5d-49c6-95e4-b5648000dc17','parse','/x/c','sendFile','use','request-screen','screen-share-started','error','join','f4e3d2c1-b0a9-8f7e-6d5c-4b3a2f1e0d9c','public','/room/','trust\x20proxy','add','get','50mb','some','E005','resetTime','screen-requested','PORT','326024QqLglD','18264246fgVXpF','slice','message','now','index.html','Server\x20running\x20on\x20http://localhost:','length','Chrome','type','readyState','Room\x20','unknown','lastEmptyTime','remoteAddress','nickname','set','participants-update','toggle-mute','webrtc-offer','x-t','join-room','connection','xiovoice.onrender.com','messages','roomId','545288jMJTXM','headers','uuid','isScreenSharing','user-mute-changed','status','split','E006','values','createdAt','userKey','cf-connecting-ip','forEach','/x/r/:roomId','close','stringify','path','has','3035100TIlrgN','screen-share-stopped','8865knnAYN','a3f8b2c1-7e4d-4a9f-8c6b-2d1e5f3a7b9c','9c8b7a6f-5e4d-3c2b-1a0f-e9d8c7b6a5f4','webrtc-ice-candidate','user-deafen-changed','/x/t','/room/:roomId','joined','avatar','Комната\x20не\x20найдена','Mozilla','env','16080KlrIoe','\x20deleted\x20(empty\x20for\x2010\x20minutes)','from','OPEN','includes','size','Failed\x20to\x20parse\x20message:','cors','2KrgNKM','socket','localhost','post','isMuted','origin'];_0x3bf9=function(){return _0x100c41;};return _0x3bf9();}function _0x11fc(_0x20e81a,_0x38d7b7){const _0x3bf9bf=_0x3bf9();return _0x11fc=function(_0x11fc5b,_0x1c6012){_0x11fc5b=_0x11fc5b-0x180;let _0x70622d=_0x3bf9bf[_0x11fc5b];return _0x70622d;},_0x11fc(_0x20e81a,_0x38d7b7);}(function(_0x291c13,_0x1a772b){const _0x1a71f4=_0x11fc,_0x46b1aa=_0x291c13();while(!![]){try{const _0x1c6224=parseInt(_0x1a71f4(0x1ca))/0x1*(-parseInt(_0x1a71f4(0x197))/0x2)+-parseInt(_0x1a71f4(0x181))/0x3+parseInt(_0x1a71f4(0x1a8))/0x4*(-parseInt(_0x1a71f4(0x1a6))/0x5)+parseInt(_0x1a71f4(0x1aa))/0x6+parseInt(_0x1a71f4(0x1b1))/0x7*(-parseInt(_0x1a71f4(0x1e4))/0x8)+parseInt(_0x1a71f4(0x183))/0x9*(parseInt(_0x1a71f4(0x18f))/0xa)+parseInt(_0x1a71f4(0x1cb))/0xb;if(_0x1c6224===_0x1a772b)break;else _0x46b1aa['push'](_0x46b1aa['shift']());}catch(_0x3bedc5){_0x46b1aa['push'](_0x46b1aa['shift']());}}}(_0x3bf9,0xc9d9e));const express=require('express'),http=require('http'),WebSocket=require('ws'),{v4:uuidv4}=require(_0x1580fd(0x1e6)),path=require(_0x1580fd(0x1f4)),app=express(),server=http[_0x1580fd(0x1ab)](app),wss=new WebSocket[(_0x1580fd(0x1b2))]({'server':server}),rooms=new Map(),clients=new Map(),rateLimit=new Map(),RATE_LIMIT_WINDOW=0xea60,RATE_LIMIT_MAX_REQUESTS=0x3,MAX_ROOMS=0x5,EMPTY_ROOM_TIMEOUT=0x927c0,csrfTokens=new Map(),CSRF_TOKEN_LIFETIME=0x493e0,suspiciousIPs=new Set(),ERR={'E001':_0x1580fd(0x1b5),'E002':_0x1580fd(0x184),'E003':_0x1580fd(0x185),'E004':_0x1580fd(0x1be),'E005':'7b6a5f4e-3d2c-1b0a-9f8e-7d6c5b4a3f2e','E006':_0x1580fd(0x1a5)};function getClientIP(_0x38c524){const _0x185b99=_0x1580fd;return _0x38c524[_0x185b99(0x1e5)][_0x185b99(0x1ef)]||_0x38c524[_0x185b99(0x1e5)][_0x185b99(0x1a1)]?.[_0x185b99(0x1ea)](',')[0x0]||_0x38c524[_0x185b99(0x1e5)]['x-real-ip']||_0x38c524[_0x185b99(0x1e0)][_0x185b99(0x1d8)]||_0x38c524[_0x185b99(0x198)][_0x185b99(0x1d8)]||_0x185b99(0x1d6);}function checkRateLimit(_0x341fb4){const _0x5eaee9=_0x1580fd;if(suspiciousIPs[_0x5eaee9(0x180)](_0x341fb4))return!0x1;const _0x4b829a=Date[_0x5eaee9(0x1ce)](),_0xd12342=rateLimit[_0x5eaee9(0x1c3)](_0x341fb4);return _0xd12342?_0x4b829a>_0xd12342[_0x5eaee9(0x1c7)]?(rateLimit['set'](_0x341fb4,{'count':0x1,'resetTime':_0x4b829a+0xea60}),!0x0):_0xd12342[_0x5eaee9(0x1ac)]>=0x3?(suspiciousIPs[_0x5eaee9(0x1c2)](_0x341fb4),setTimeout(()=>suspiciousIPs[_0x5eaee9(0x1a3)](_0x341fb4),0x36ee80),!0x1):(_0xd12342[_0x5eaee9(0x1ac)]++,!0x0):(rateLimit['set'](_0x341fb4,{'count':0x1,'resetTime':_0x4b829a+0xea60}),!0x0);}function isValidRequest(_0x3525cb){const _0x51321b=_0x1580fd,_0x2ab048=_0x3525cb['headers']['user-agent']||'',_0x311443=_0x3525cb[_0x51321b(0x1e5)][_0x51321b(0x19c)]||'',_0x1a7dcd=_0x3525cb['headers']['sec-fetch-site']||'',_0x890490=_0x3525cb[_0x51321b(0x1e5)][_0x51321b(0x1a2)]||'',_0x424abd=[_0x51321b(0x18d),_0x51321b(0x1d2),'Safari','Firefox',_0x51321b(0x1a7),'Opera'][_0x51321b(0x1c5)](_0x4fc063=>_0x2ab048[_0x51321b(0x193)](_0x4fc063)),_0x25c797=_0x311443[_0x51321b(0x193)](_0x51321b(0x1e1))||_0x311443[_0x51321b(0x193)](_0x51321b(0x199));return _0x424abd&&_0x25c797&&('same-origin'===_0x1a7dcd&&_0x51321b(0x196)===_0x890490);}function broadcast(_0x3744cc,_0x46ef36,_0xb3aa4f=null){const _0x40e5a4=_0x1580fd,_0x567c7c=rooms[_0x40e5a4(0x1c3)](_0x3744cc);_0x567c7c&&_0x567c7c['participants']['forEach']((_0x691d15,_0x177614)=>{const _0x58e979=_0x40e5a4;if(_0xb3aa4f&&_0x177614===_0xb3aa4f)return;const _0x3f0977=clients[_0x58e979(0x1c3)](_0x177614);_0x3f0977&&_0x3f0977['ws']['readyState']===WebSocket[_0x58e979(0x192)]&&_0x3f0977['ws'][_0x58e979(0x1a9)](JSON[_0x58e979(0x1f3)](_0x46ef36));});}function sendToClient(_0x4559cb,_0x353fb1){const _0x336944=_0x1580fd,_0x323dd7=clients['get'](_0x4559cb);_0x323dd7&&_0x323dd7['ws'][_0x336944(0x1d4)]===WebSocket[_0x336944(0x192)]&&_0x323dd7['ws'][_0x336944(0x1a9)](JSON['stringify'](_0x353fb1));}function handleMessage(_0x1b7b07,_0x3ed49a){const _0x52ca1b=_0x1580fd,_0x3ed320=clients[_0x52ca1b(0x1c3)](_0x1b7b07);if(_0x3ed320)switch(_0x3ed49a[_0x52ca1b(0x1d3)]){case _0x52ca1b(0x1df):{const {roomId:_0x232846,nickname:_0x3ebc95}=_0x3ed49a,_0x2d43f1=rooms[_0x52ca1b(0x1c3)](_0x232846);if(!_0x2d43f1)return void sendToClient(_0x1b7b07,{'type':_0x52ca1b(0x1bc),'message':_0x52ca1b(0x18c)});const _0x514607=uuidv4()['slice'](0x0,0x8);_0x3ed320['roomId']=_0x232846,_0x3ed320['nickname']=_0x3ebc95,_0x3ed320[_0x52ca1b(0x1ee)]=_0x514607,_0x2d43f1[_0x52ca1b(0x1b0)]['set'](_0x1b7b07,{'id':_0x1b7b07,'nickname':_0x3ebc95,'userKey':_0x514607,'joinedAt':Date[_0x52ca1b(0x1ce)](),'isMuted':!0x1,'isDeafened':!0x1,'isScreenSharing':!0x1,'avatar':null}),_0x2d43f1[_0x52ca1b(0x1d7)]=null,sendToClient(_0x1b7b07,{'type':_0x52ca1b(0x18a),'roomId':_0x232846,'userKey':_0x514607,'participants':Array[_0x52ca1b(0x191)](_0x2d43f1[_0x52ca1b(0x1b0)][_0x52ca1b(0x1ec)]()),'messages':_0x2d43f1[_0x52ca1b(0x1e2)][_0x52ca1b(0x1cc)](-0x32)}),broadcast(_0x232846,{'type':'user-joined','user':{'id':_0x1b7b07,'nickname':_0x3ebc95,'userKey':_0x514607}},_0x1b7b07),broadcast(_0x232846,{'type':'participants-update','participants':Array[_0x52ca1b(0x191)](_0x2d43f1['participants']['values']())});break;}case _0x52ca1b(0x19d):{const {roomId:_0x34394c,content:_0xd4b37c,image:_0x1ca446}=_0x3ed49a,_0x414e2b=rooms[_0x52ca1b(0x1c3)](_0x34394c);if(!_0x414e2b)return;const _0x515ac7={'id':uuidv4(),'senderId':_0x1b7b07,'senderName':_0x3ed320[_0x52ca1b(0x1d9)],'content':_0xd4b37c,'image':_0x1ca446,'timestamp':Date['now']()};_0x414e2b[_0x52ca1b(0x1e2)]['push'](_0x515ac7),_0x414e2b[_0x52ca1b(0x1e2)][_0x52ca1b(0x1d1)]>0xc8&&(_0x414e2b[_0x52ca1b(0x1e2)]=_0x414e2b[_0x52ca1b(0x1e2)][_0x52ca1b(0x1cc)](-0x64)),broadcast(_0x34394c,{'type':'chat-message','message':_0x515ac7});break;}case'webrtc-offer':{const {targetId:_0x2f94e3,offer:_0x43bf16}=_0x3ed49a;sendToClient(_0x2f94e3,{'type':_0x52ca1b(0x1dd),'senderId':_0x1b7b07,'senderName':_0x3ed320[_0x52ca1b(0x1d9)],'offer':_0x43bf16});break;}case _0x52ca1b(0x1b4):{const {targetId:_0x2a5348,answer:_0x560df6}=_0x3ed49a;sendToClient(_0x2a5348,{'type':_0x52ca1b(0x1b4),'senderId':_0x1b7b07,'answer':_0x560df6});break;}case _0x52ca1b(0x186):{const {targetId:_0x40584f,candidate:_0x5dd275}=_0x3ed49a;sendToClient(_0x40584f,{'type':_0x52ca1b(0x186),'senderId':_0x1b7b07,'candidate':_0x5dd275});break;}case _0x52ca1b(0x1dc):{const _0x5de6c2=rooms[_0x52ca1b(0x1c3)](_0x3ed320[_0x52ca1b(0x1e3)]);if(!_0x5de6c2)return;const _0x46d0f8=_0x5de6c2[_0x52ca1b(0x1b0)]['get'](_0x1b7b07);_0x46d0f8&&(_0x46d0f8[_0x52ca1b(0x19b)]=_0x3ed49a['isMuted'],broadcast(_0x3ed320[_0x52ca1b(0x1e3)],{'type':_0x52ca1b(0x1e8),'clientId':_0x1b7b07,'isMuted':_0x3ed49a['isMuted']}));break;}case'update-avatar':{const _0x2a2da6=rooms[_0x52ca1b(0x1c3)](_0x3ed320[_0x52ca1b(0x1e3)]);if(!_0x2a2da6)return;const _0x76f102=_0x2a2da6[_0x52ca1b(0x1b0)][_0x52ca1b(0x1c3)](_0x1b7b07);_0x76f102&&(_0x76f102[_0x52ca1b(0x18b)]=_0x3ed49a[_0x52ca1b(0x18b)],broadcast(_0x3ed320[_0x52ca1b(0x1e3)],{'type':_0x52ca1b(0x19f),'clientId':_0x1b7b07,'avatar':_0x3ed49a[_0x52ca1b(0x18b)]}));break;}case'toggle-deafen':{const _0x3d066f=rooms['get'](_0x3ed320[_0x52ca1b(0x1e3)]);if(!_0x3d066f)return;const _0x3c256b=_0x3d066f['participants'][_0x52ca1b(0x1c3)](_0x1b7b07);_0x3c256b&&(_0x3c256b['isDeafened']=_0x3ed49a[_0x52ca1b(0x1af)],broadcast(_0x3ed320[_0x52ca1b(0x1e3)],{'type':_0x52ca1b(0x187),'clientId':_0x1b7b07,'isDeafened':_0x3ed49a['isDeafened']}));break;}case _0x52ca1b(0x1bb):{const _0x30c76a=rooms['get'](_0x3ed320['roomId']);if(!_0x30c76a)return;const _0x50a0f1=_0x30c76a[_0x52ca1b(0x1b0)][_0x52ca1b(0x1c3)](_0x1b7b07);_0x50a0f1&&(_0x50a0f1[_0x52ca1b(0x1e7)]=!0x0,broadcast(_0x3ed320[_0x52ca1b(0x1e3)],{'type':_0x52ca1b(0x1bb),'clientId':_0x1b7b07,'nickname':_0x3ed320[_0x52ca1b(0x1d9)]}));break;}case _0x52ca1b(0x182):{const _0x35fdef=rooms[_0x52ca1b(0x1c3)](_0x3ed320['roomId']);if(!_0x35fdef)return;const _0x357070=_0x35fdef['participants']['get'](_0x1b7b07);_0x357070&&(_0x357070[_0x52ca1b(0x1e7)]=!0x1,broadcast(_0x3ed320[_0x52ca1b(0x1e3)],{'type':_0x52ca1b(0x182),'clientId':_0x1b7b07}));break;}case _0x52ca1b(0x1ba):{const {targetId:_0x5fa6ae}=_0x3ed49a;sendToClient(_0x5fa6ae,{'type':_0x52ca1b(0x1c8),'requesterId':_0x1b7b07});break;}}}setInterval(()=>{const _0x22b81d=_0x1580fd,_0x2809c5=Date[_0x22b81d(0x1ce)]();for(const [_0x5cfbc2,_0x3cea65]of rateLimit['entries']())_0x2809c5>_0x3cea65[_0x22b81d(0x1c7)]&&rateLimit['delete'](_0x5cfbc2);},0xea60),app[_0x1580fd(0x1da)](_0x1580fd(0x1c1),!0x0),app[_0x1580fd(0x1b9)](express['static'](path[_0x1580fd(0x1bd)](__dirname,'public'))),app['use'](express[_0x1580fd(0x1a4)]({'limit':_0x1580fd(0x1c4)})),app[_0x1580fd(0x1c3)]('/',(_0x508f1c,_0x5cd5aa)=>{const _0x52b60d=_0x1580fd;_0x5cd5aa[_0x52b60d(0x1b8)](path[_0x52b60d(0x1bd)](__dirname,_0x52b60d(0x1bf),_0x52b60d(0x1cf)));}),app[_0x1580fd(0x1c3)](_0x1580fd(0x189),(_0x186a71,_0x2370a4)=>{const _0x4f6e3f=_0x1580fd;_0x2370a4['sendFile'](path[_0x4f6e3f(0x1bd)](__dirname,'public',_0x4f6e3f(0x1cf)));}),app[_0x1580fd(0x1c3)](_0x1580fd(0x188),(_0x169a35,_0x219e1f)=>{const _0x32c8e5=_0x1580fd,_0x1380c9=uuidv4(),_0x1048fe=getClientIP(_0x169a35);csrfTokens[_0x32c8e5(0x1da)](_0x1380c9,{'ip':_0x1048fe,'createdAt':Date['now']()}),setTimeout(()=>csrfTokens[_0x32c8e5(0x1a3)](_0x1380c9),0x493e0),_0x219e1f[_0x32c8e5(0x1a4)]({'d':_0x1380c9});}),app[_0x1580fd(0x19a)](_0x1580fd(0x1b7),(_0x1b9d06,_0x49992d)=>{const _0x3e393c=_0x1580fd,_0x5cc5d0=getClientIP(_0x1b9d06),_0x5800c3=_0x1b9d06['headers'][_0x3e393c(0x1de)];if(!_0x5800c3||!csrfTokens[_0x3e393c(0x180)](_0x5800c3))return _0x49992d['status'](0x193)[_0x3e393c(0x1a4)]({'c':ERR['E001']});const _0x35a296=csrfTokens['get'](_0x5800c3);csrfTokens['delete'](_0x5800c3);const _0x276945=Date['now']()-_0x35a296[_0x3e393c(0x1ed)];if(_0x276945>0x493e0)return _0x49992d[_0x3e393c(0x1e9)](0x193)[_0x3e393c(0x1a4)]({'c':ERR[_0x3e393c(0x1b3)]});if(_0x276945<0x3e8)return suspiciousIPs['add'](_0x5cc5d0),_0x49992d[_0x3e393c(0x1e9)](0x193)[_0x3e393c(0x1a4)]({'c':ERR[_0x3e393c(0x19e)]});if(!isValidRequest(_0x1b9d06))return suspiciousIPs[_0x3e393c(0x1c2)](_0x5cc5d0),_0x49992d[_0x3e393c(0x1e9)](0x193)['json']({'c':ERR[_0x3e393c(0x1ae)]});if(!checkRateLimit(_0x5cc5d0))return _0x49992d['status'](0x1ad)['json']({'c':ERR[_0x3e393c(0x1c6)]});if(rooms[_0x3e393c(0x194)]>=0x5)return _0x49992d[_0x3e393c(0x1e9)](0x1f7)[_0x3e393c(0x1a4)]({'c':ERR[_0x3e393c(0x1eb)],'limit':!0x0});const _0x54dd3a=uuidv4()[_0x3e393c(0x1cc)](0x0,0x8),_0x2146be=uuidv4()['slice'](0x0,0xc);rooms[_0x3e393c(0x1da)](_0x54dd3a,{'id':_0x54dd3a,'adminKey':_0x2146be,'createdAt':Date['now'](),'lastEmptyTime':Date[_0x3e393c(0x1ce)](),'participants':new Map(),'messages':[]}),_0x49992d[_0x3e393c(0x1a4)]({'r':_0x54dd3a,'k':_0x2146be,'l':_0x3e393c(0x1c0)+_0x54dd3a});}),app[_0x1580fd(0x1c3)](_0x1580fd(0x1f1),(_0x5d6d94,_0x47229a)=>{const _0x5cb0c9=_0x1580fd,_0x4562ed=rooms[_0x5cb0c9(0x1c3)](_0x5d6d94['params'][_0x5cb0c9(0x1e3)]);if(!_0x4562ed)return _0x47229a['status'](0x194)[_0x5cb0c9(0x1a4)]({'c':0x0});_0x47229a[_0x5cb0c9(0x1a4)]({'e':0x1,'p':_0x4562ed[_0x5cb0c9(0x1b0)][_0x5cb0c9(0x194)]});}),wss['on'](_0x1580fd(0x1e0),_0x1219c9=>{const _0x3afe76=_0x1580fd,_0x4f4304=uuidv4();clients[_0x3afe76(0x1da)](_0x4f4304,{'ws':_0x1219c9,'roomId':null,'nickname':null,'odId':null}),_0x1219c9[_0x3afe76(0x1a9)](JSON[_0x3afe76(0x1f3)]({'type':'connected','clientId':_0x4f4304})),_0x1219c9['on'](_0x3afe76(0x1cd),_0xa6fe9a=>{const _0x2dbf2b=_0x3afe76;try{const _0x53bb7a=JSON[_0x2dbf2b(0x1b6)](_0xa6fe9a);handleMessage(_0x4f4304,_0x53bb7a);}catch(_0x565dd3){console[_0x2dbf2b(0x1bc)](_0x2dbf2b(0x195),_0x565dd3);}}),_0x1219c9['on'](_0x3afe76(0x1f2),()=>{const _0xa16228=_0x3afe76,_0x2ef377=clients[_0xa16228(0x1c3)](_0x4f4304);if(_0x2ef377&&_0x2ef377[_0xa16228(0x1e3)]){const _0x14bfe0=rooms[_0xa16228(0x1c3)](_0x2ef377[_0xa16228(0x1e3)]);_0x14bfe0&&(_0x14bfe0[_0xa16228(0x1b0)][_0xa16228(0x1a3)](_0x4f4304),0x0===_0x14bfe0['participants'][_0xa16228(0x194)]&&(_0x14bfe0[_0xa16228(0x1d7)]=Date[_0xa16228(0x1ce)]()),broadcast(_0x2ef377[_0xa16228(0x1e3)],{'type':'user-left','clientId':_0x4f4304,'nickname':_0x2ef377[_0xa16228(0x1d9)]}),broadcast(_0x2ef377[_0xa16228(0x1e3)],{'type':_0xa16228(0x1db),'participants':Array[_0xa16228(0x191)](_0x14bfe0[_0xa16228(0x1b0)][_0xa16228(0x1ec)]())}));}clients[_0xa16228(0x1a3)](_0x4f4304);});}),setInterval(()=>{const _0x18c46f=_0x1580fd,_0x4e4b5a=Date[_0x18c46f(0x1ce)]();rooms[_0x18c46f(0x1f0)]((_0x296b1d,_0x191dcc)=>{const _0x496c8b=_0x18c46f;0x0===_0x296b1d['participants']['size']&&_0x296b1d['lastEmptyTime']&&_0x4e4b5a-_0x296b1d[_0x496c8b(0x1d7)]>0x927c0&&(rooms[_0x496c8b(0x1a3)](_0x191dcc),console[_0x496c8b(0x1ad)](_0x496c8b(0x1d5)+_0x191dcc+_0x496c8b(0x190)));});},0xea60);const PORT=process[_0x1580fd(0x18e)][_0x1580fd(0x1c9)]||0xbb8;server[_0x1580fd(0x1a0)](PORT,()=>{const _0x35b085=_0x1580fd;console['log'](_0x35b085(0x1d0)+PORT);});