function _0x86de(){const _0x2fdbc9=['use','user-left','E004','245hNWCle','Room\x20','size','sec-fetch-mode','cors','close','includes','nickname','status','E001','roomId','E006','isScreenSharing','json','1473104kdGUvN','add','\x20deleted\x20(empty\x20for\x2010\x20minutes)','webrtc-offer','type','listen','set','user-avatar-changed','joined','connected','length','headers','Mozilla','screen-share-started','push','values','trust\x20proxy','x-t','user-agent','x-forwarded-for','toggle-mute','webrtc-answer','readyState','send','update-avatar','now','user-mute-changed','183285vLWnDB','2e1d0c9b-8a7f-6e5d-4c3b-2a1f0e9d8c7b','createServer','Edge','origin','sec-fetch-site','cf-connecting-ip','screen-requested','connection','1819122mJWLXX','log','resetTime','participants','uuid','params','chat-message','userKey','249176CPdEEV','createdAt','50mb','isDeafened','Комната\x20не\x20найдена','xiovoice.onrender.com','toggle-deafen','webrtc-ice-candidate','2ViuJLE','sendFile','join-room','2377593PIgEZL','split','error','Chrome','isMuted','stringify','messages','d107fc57-3a5d-49c6-95e4-b5648000dc17','slice','Firefox','socket','index.html','user-deafen-changed','OPEN','remoteAddress','get','forEach','delete','some','entries','public','Safari','has','7b6a5f4e-3d2c-1b0a-9f8e-7d6c5b4a3f2e','11989440CrqtmR','Server','unknown','f4e3d2c1-b0a9-8f7e-6d5c-4b3a2f1e0d9c','E002','lastEmptyTime','post','participants-update','screen-share-stopped','483358leVype','join','PORT','from','avatar','25teonPa'];_0x86de=function(){return _0x2fdbc9;};return _0x86de();}const _0xc3ae3d=_0xebbe;(function(_0x4b848b,_0x187419){const _0x74844d=_0xebbe,_0x17e874=_0x4b848b();while(!![]){try{const _0xe54253=-parseInt(_0x74844d(0x126))/0x1+parseInt(_0x74844d(0x102))/0x2*(-parseInt(_0x74844d(0x158))/0x3)+-parseInt(_0x74844d(0x13d))/0x4+parseInt(_0x74844d(0x12b))/0x5*(parseInt(_0x74844d(0x161))/0x6)+parseInt(_0x74844d(0x12f))/0x7*(-parseInt(_0x74844d(0x169))/0x8)+parseInt(_0x74844d(0x105))/0x9+parseInt(_0x74844d(0x11d))/0xa;if(_0xe54253===_0x187419)break;else _0x17e874['push'](_0x17e874['shift']());}catch(_0x150ea4){_0x17e874['push'](_0x17e874['shift']());}}}(_0x86de,0xee536));const express=require('express'),http=require('http'),WebSocket=require('ws'),{v4:uuidv4}=require(_0xc3ae3d(0x165)),path=require('path'),app=express(),server=http[_0xc3ae3d(0x15a)](app),wss=new WebSocket[(_0xc3ae3d(0x11e))]({'server':server}),rooms=new Map(),clients=new Map(),rateLimit=new Map(),RATE_LIMIT_WINDOW=0xea60,RATE_LIMIT_MAX_REQUESTS=0x3,MAX_ROOMS=0x5,EMPTY_ROOM_TIMEOUT=0x927c0,csrfTokens=new Map(),CSRF_TOKEN_LIFETIME=0x493e0,suspiciousIPs=new Set(),ERR={'E001':_0xc3ae3d(0x10c),'E002':'a3f8b2c1-7e4d-4a9f-8c6b-2d1e5f3a7b9c','E003':'9c8b7a6f-5e4d-3c2b-1a0f-e9d8c7b6a5f4','E004':_0xc3ae3d(0x120),'E005':_0xc3ae3d(0x11c),'E006':_0xc3ae3d(0x159)};function getClientIP(_0x4c04cc){const _0x479ad3=_0xc3ae3d;return _0x4c04cc[_0x479ad3(0x148)][_0x479ad3(0x15e)]||_0x4c04cc[_0x479ad3(0x148)][_0x479ad3(0x150)]?.[_0x479ad3(0x106)](',')[0x0]||_0x4c04cc['headers']['x-real-ip']||_0x4c04cc['connection'][_0x479ad3(0x113)]||_0x4c04cc[_0x479ad3(0x10f)]['remoteAddress']||_0x479ad3(0x11f);}function checkRateLimit(_0x528102){const _0x1bdfb5=_0xc3ae3d;if(suspiciousIPs[_0x1bdfb5(0x11b)](_0x528102))return!0x1;const _0x4daf4d=Date[_0x1bdfb5(0x156)](),_0x12296d=rateLimit[_0x1bdfb5(0x114)](_0x528102);return _0x12296d?_0x4daf4d>_0x12296d['resetTime']?(rateLimit[_0x1bdfb5(0x143)](_0x528102,{'count':0x1,'resetTime':_0x4daf4d+0xea60}),!0x0):_0x12296d['count']>=0x3?(suspiciousIPs[_0x1bdfb5(0x13e)](_0x528102),setTimeout(()=>suspiciousIPs[_0x1bdfb5(0x116)](_0x528102),0x36ee80),!0x1):(_0x12296d['count']++,!0x0):(rateLimit[_0x1bdfb5(0x143)](_0x528102,{'count':0x1,'resetTime':_0x4daf4d+0xea60}),!0x0);}function isValidRequest(_0x3b0434){const _0x3407f3=_0xc3ae3d,_0x181cb8=_0x3b0434['headers'][_0x3407f3(0x14f)]||'',_0x4c46e7=_0x3b0434[_0x3407f3(0x148)][_0x3407f3(0x15c)]||'',_0x261cd9=_0x3b0434[_0x3407f3(0x148)][_0x3407f3(0x15d)]||'',_0x37dbcb=_0x3b0434[_0x3407f3(0x148)][_0x3407f3(0x132)]||'',_0x4e751e=[_0x3407f3(0x149),_0x3407f3(0x108),_0x3407f3(0x11a),_0x3407f3(0x10e),_0x3407f3(0x15b),'Opera'][_0x3407f3(0x117)](_0x38da3b=>_0x181cb8[_0x3407f3(0x135)](_0x38da3b)),_0xe31ed=_0x4c46e7[_0x3407f3(0x135)](_0x3407f3(0xff))||_0x4c46e7['includes']('localhost');return _0x4e751e&&_0xe31ed&&('same-origin'===_0x261cd9&&_0x3407f3(0x133)===_0x37dbcb);}function _0xebbe(_0x56d4c0,_0x590503){const _0x86de75=_0x86de();return _0xebbe=function(_0xebbec6,_0x29bc4a){_0xebbec6=_0xebbec6-0xfb;let _0x3c66d2=_0x86de75[_0xebbec6];return _0x3c66d2;},_0xebbe(_0x56d4c0,_0x590503);}function broadcast(_0x3aae87,_0x3ea69d,_0x40844b=null){const _0x1aa491=_0xc3ae3d,_0x391e92=rooms[_0x1aa491(0x114)](_0x3aae87);_0x391e92&&_0x391e92[_0x1aa491(0x164)][_0x1aa491(0x115)]((_0x9a1ae0,_0x38f1c6)=>{const _0x16c128=_0x1aa491;if(_0x40844b&&_0x38f1c6===_0x40844b)return;const _0x51ba05=clients[_0x16c128(0x114)](_0x38f1c6);_0x51ba05&&_0x51ba05['ws'][_0x16c128(0x153)]===WebSocket[_0x16c128(0x112)]&&_0x51ba05['ws']['send'](JSON[_0x16c128(0x10a)](_0x3ea69d));});}function sendToClient(_0x496287,_0x7baaf2){const _0xc9fe23=_0xc3ae3d,_0x294312=clients[_0xc9fe23(0x114)](_0x496287);_0x294312&&_0x294312['ws']['readyState']===WebSocket['OPEN']&&_0x294312['ws'][_0xc9fe23(0x154)](JSON[_0xc9fe23(0x10a)](_0x7baaf2));}function handleMessage(_0x3ba95c,_0x538715){const _0x25ebd0=_0xc3ae3d,_0x97a47d=clients[_0x25ebd0(0x114)](_0x3ba95c);if(_0x97a47d)switch(_0x538715[_0x25ebd0(0x141)]){case _0x25ebd0(0x104):{const {roomId:_0x39d970,nickname:_0x4ffaa1}=_0x538715,_0x2a14d7=rooms[_0x25ebd0(0x114)](_0x39d970);if(!_0x2a14d7)return void sendToClient(_0x3ba95c,{'type':_0x25ebd0(0x107),'message':_0x25ebd0(0xfe)});const _0x3b08b3=uuidv4()[_0x25ebd0(0x10d)](0x0,0x8);_0x97a47d[_0x25ebd0(0x139)]=_0x39d970,_0x97a47d[_0x25ebd0(0x136)]=_0x4ffaa1,_0x97a47d[_0x25ebd0(0x168)]=_0x3b08b3,_0x2a14d7[_0x25ebd0(0x164)][_0x25ebd0(0x143)](_0x3ba95c,{'id':_0x3ba95c,'nickname':_0x4ffaa1,'userKey':_0x3b08b3,'joinedAt':Date['now'](),'isMuted':!0x1,'isDeafened':!0x1,'isScreenSharing':!0x1,'avatar':null}),_0x2a14d7[_0x25ebd0(0x122)]=null,sendToClient(_0x3ba95c,{'type':_0x25ebd0(0x145),'roomId':_0x39d970,'userKey':_0x3b08b3,'participants':Array[_0x25ebd0(0x129)](_0x2a14d7[_0x25ebd0(0x164)][_0x25ebd0(0x14c)]()),'messages':_0x2a14d7['messages'][_0x25ebd0(0x10d)](-0x32)}),broadcast(_0x39d970,{'type':'user-joined','user':{'id':_0x3ba95c,'nickname':_0x4ffaa1,'userKey':_0x3b08b3}},_0x3ba95c),broadcast(_0x39d970,{'type':_0x25ebd0(0x124),'participants':Array['from'](_0x2a14d7['participants']['values']())});break;}case _0x25ebd0(0x167):{const {roomId:_0x10a2a3,content:_0x5b723b,image:_0x4ad7be}=_0x538715,_0x551ead=rooms[_0x25ebd0(0x114)](_0x10a2a3);if(!_0x551ead)return;const _0x372e74={'id':uuidv4(),'senderId':_0x3ba95c,'senderName':_0x97a47d[_0x25ebd0(0x136)],'content':_0x5b723b,'image':_0x4ad7be,'timestamp':Date[_0x25ebd0(0x156)]()};_0x551ead[_0x25ebd0(0x10b)][_0x25ebd0(0x14b)](_0x372e74),_0x551ead[_0x25ebd0(0x10b)][_0x25ebd0(0x147)]>0xc8&&(_0x551ead['messages']=_0x551ead[_0x25ebd0(0x10b)][_0x25ebd0(0x10d)](-0x64)),broadcast(_0x10a2a3,{'type':'chat-message','message':_0x372e74});break;}case _0x25ebd0(0x140):{const {targetId:_0xbea081,offer:_0xe089ee}=_0x538715;sendToClient(_0xbea081,{'type':_0x25ebd0(0x140),'senderId':_0x3ba95c,'senderName':_0x97a47d[_0x25ebd0(0x136)],'offer':_0xe089ee});break;}case'webrtc-answer':{const {targetId:_0x626c7b,answer:_0x1d2866}=_0x538715;sendToClient(_0x626c7b,{'type':_0x25ebd0(0x152),'senderId':_0x3ba95c,'answer':_0x1d2866});break;}case'webrtc-ice-candidate':{const {targetId:_0x70d657,candidate:_0x13a1e8}=_0x538715;sendToClient(_0x70d657,{'type':_0x25ebd0(0x101),'senderId':_0x3ba95c,'candidate':_0x13a1e8});break;}case _0x25ebd0(0x151):{const _0x47d9bf=rooms[_0x25ebd0(0x114)](_0x97a47d[_0x25ebd0(0x139)]);if(!_0x47d9bf)return;const _0x344e7c=_0x47d9bf[_0x25ebd0(0x164)][_0x25ebd0(0x114)](_0x3ba95c);_0x344e7c&&(_0x344e7c[_0x25ebd0(0x109)]=_0x538715[_0x25ebd0(0x109)],broadcast(_0x97a47d[_0x25ebd0(0x139)],{'type':_0x25ebd0(0x157),'clientId':_0x3ba95c,'isMuted':_0x538715[_0x25ebd0(0x109)]}));break;}case _0x25ebd0(0x155):{const _0x1bc585=rooms[_0x25ebd0(0x114)](_0x97a47d[_0x25ebd0(0x139)]);if(!_0x1bc585)return;const _0x25ce17=_0x1bc585[_0x25ebd0(0x164)]['get'](_0x3ba95c);_0x25ce17&&(_0x25ce17[_0x25ebd0(0x12a)]=_0x538715['avatar'],broadcast(_0x97a47d[_0x25ebd0(0x139)],{'type':_0x25ebd0(0x144),'clientId':_0x3ba95c,'avatar':_0x538715[_0x25ebd0(0x12a)]}));break;}case _0x25ebd0(0x100):{const _0x23b7b0=rooms['get'](_0x97a47d[_0x25ebd0(0x139)]);if(!_0x23b7b0)return;const _0x229350=_0x23b7b0['participants'][_0x25ebd0(0x114)](_0x3ba95c);_0x229350&&(_0x229350['isDeafened']=_0x538715[_0x25ebd0(0xfd)],broadcast(_0x97a47d['roomId'],{'type':_0x25ebd0(0x111),'clientId':_0x3ba95c,'isDeafened':_0x538715[_0x25ebd0(0xfd)]}));break;}case _0x25ebd0(0x14a):{const _0xb4d21f=rooms['get'](_0x97a47d[_0x25ebd0(0x139)]);if(!_0xb4d21f)return;const _0x44ac6c=_0xb4d21f[_0x25ebd0(0x164)][_0x25ebd0(0x114)](_0x3ba95c);_0x44ac6c&&(_0x44ac6c[_0x25ebd0(0x13b)]=!0x0,broadcast(_0x97a47d['roomId'],{'type':_0x25ebd0(0x14a),'clientId':_0x3ba95c,'nickname':_0x97a47d[_0x25ebd0(0x136)]}));break;}case _0x25ebd0(0x125):{const _0x520fbe=rooms[_0x25ebd0(0x114)](_0x97a47d[_0x25ebd0(0x139)]);if(!_0x520fbe)return;const _0x22033b=_0x520fbe[_0x25ebd0(0x164)][_0x25ebd0(0x114)](_0x3ba95c);_0x22033b&&(_0x22033b[_0x25ebd0(0x13b)]=!0x1,broadcast(_0x97a47d[_0x25ebd0(0x139)],{'type':_0x25ebd0(0x125),'clientId':_0x3ba95c}));break;}case'request-screen':{const {targetId:_0x2f9812}=_0x538715;sendToClient(_0x2f9812,{'type':_0x25ebd0(0x15f),'requesterId':_0x3ba95c});break;}}}setInterval(()=>{const _0x13f7f4=_0xc3ae3d,_0x179b10=Date[_0x13f7f4(0x156)]();for(const [_0x52f5d7,_0x2f03e9]of rateLimit[_0x13f7f4(0x118)]())_0x179b10>_0x2f03e9[_0x13f7f4(0x163)]&&rateLimit[_0x13f7f4(0x116)](_0x52f5d7);},0xea60),app[_0xc3ae3d(0x143)](_0xc3ae3d(0x14d),!0x0),app['use'](express['static'](path['join'](__dirname,'public'))),app[_0xc3ae3d(0x12c)](express[_0xc3ae3d(0x13c)]({'limit':_0xc3ae3d(0xfc)})),app['get']('/',(_0x666b2f,_0x50ee1b)=>{const _0x43360b=_0xc3ae3d;_0x50ee1b[_0x43360b(0x103)](path[_0x43360b(0x127)](__dirname,_0x43360b(0x119),_0x43360b(0x110)));}),app['get']('/room/:roomId',(_0x4436f8,_0x2c1563)=>{const _0x42f7dc=_0xc3ae3d;_0x2c1563[_0x42f7dc(0x103)](path[_0x42f7dc(0x127)](__dirname,_0x42f7dc(0x119),_0x42f7dc(0x110)));}),app[_0xc3ae3d(0x114)]('/x/t',(_0xaafc3b,_0x56756f)=>{const _0x5ade94=_0xc3ae3d,_0x682c9=uuidv4(),_0x564ef0=getClientIP(_0xaafc3b);csrfTokens[_0x5ade94(0x143)](_0x682c9,{'ip':_0x564ef0,'createdAt':Date[_0x5ade94(0x156)]()}),setTimeout(()=>csrfTokens[_0x5ade94(0x116)](_0x682c9),0x493e0),_0x56756f[_0x5ade94(0x13c)]({'d':_0x682c9});}),app[_0xc3ae3d(0x123)]('/x/c',(_0x30eaf6,_0x264e4c)=>{const _0x1ed0ba=_0xc3ae3d,_0x135bad=getClientIP(_0x30eaf6),_0x5bc5db=_0x30eaf6[_0x1ed0ba(0x148)][_0x1ed0ba(0x14e)];if(!_0x5bc5db||!csrfTokens[_0x1ed0ba(0x11b)](_0x5bc5db))return _0x264e4c['status'](0x193)['json']({'c':ERR[_0x1ed0ba(0x138)]});const _0x52c5ea=csrfTokens[_0x1ed0ba(0x114)](_0x5bc5db);csrfTokens[_0x1ed0ba(0x116)](_0x5bc5db);const _0x1a5572=Date[_0x1ed0ba(0x156)]()-_0x52c5ea[_0x1ed0ba(0xfb)];if(_0x1a5572>0x493e0)return _0x264e4c[_0x1ed0ba(0x137)](0x193)[_0x1ed0ba(0x13c)]({'c':ERR[_0x1ed0ba(0x121)]});if(_0x1a5572<0x3e8)return suspiciousIPs[_0x1ed0ba(0x13e)](_0x135bad),_0x264e4c[_0x1ed0ba(0x137)](0x193)['json']({'c':ERR['E003']});if(!isValidRequest(_0x30eaf6))return suspiciousIPs['add'](_0x135bad),_0x264e4c[_0x1ed0ba(0x137)](0x193)[_0x1ed0ba(0x13c)]({'c':ERR[_0x1ed0ba(0x12e)]});if(!checkRateLimit(_0x135bad))return _0x264e4c[_0x1ed0ba(0x137)](0x1ad)['json']({'c':ERR['E005']});if(rooms[_0x1ed0ba(0x131)]>=0x5)return _0x264e4c[_0x1ed0ba(0x137)](0x1f7)[_0x1ed0ba(0x13c)]({'c':ERR[_0x1ed0ba(0x13a)],'limit':!0x0});const _0x7673b=uuidv4()['slice'](0x0,0x8),_0x2e8663=uuidv4()['slice'](0x0,0xc);rooms['set'](_0x7673b,{'id':_0x7673b,'adminKey':_0x2e8663,'createdAt':Date['now'](),'lastEmptyTime':Date['now'](),'participants':new Map(),'messages':[]}),_0x264e4c[_0x1ed0ba(0x13c)]({'r':_0x7673b,'k':_0x2e8663,'l':'/room/'+_0x7673b});}),app[_0xc3ae3d(0x114)]('/x/r/:roomId',(_0x8c4a32,_0x3b2b08)=>{const _0x2f0efc=_0xc3ae3d,_0x25bb37=rooms[_0x2f0efc(0x114)](_0x8c4a32[_0x2f0efc(0x166)][_0x2f0efc(0x139)]);if(!_0x25bb37)return _0x3b2b08[_0x2f0efc(0x137)](0x194)[_0x2f0efc(0x13c)]({'c':0x0});_0x3b2b08[_0x2f0efc(0x13c)]({'e':0x1,'p':_0x25bb37['participants'][_0x2f0efc(0x131)]});}),wss['on'](_0xc3ae3d(0x160),_0x38f0b6=>{const _0x257ab8=_0xc3ae3d,_0x4b3564=uuidv4();clients[_0x257ab8(0x143)](_0x4b3564,{'ws':_0x38f0b6,'roomId':null,'nickname':null,'odId':null}),_0x38f0b6[_0x257ab8(0x154)](JSON['stringify']({'type':_0x257ab8(0x146),'clientId':_0x4b3564})),_0x38f0b6['on']('message',_0x2ee3a5=>{const _0x1f227d=_0x257ab8;try{const _0x3230bb=JSON['parse'](_0x2ee3a5);handleMessage(_0x4b3564,_0x3230bb);}catch(_0x7984fa){console[_0x1f227d(0x107)]('Failed\x20to\x20parse\x20message:',_0x7984fa);}}),_0x38f0b6['on'](_0x257ab8(0x134),()=>{const _0x47e73f=_0x257ab8,_0x19dced=clients[_0x47e73f(0x114)](_0x4b3564);if(_0x19dced&&_0x19dced[_0x47e73f(0x139)]){const _0x266807=rooms['get'](_0x19dced[_0x47e73f(0x139)]);_0x266807&&(_0x266807[_0x47e73f(0x164)][_0x47e73f(0x116)](_0x4b3564),0x0===_0x266807[_0x47e73f(0x164)][_0x47e73f(0x131)]&&(_0x266807[_0x47e73f(0x122)]=Date[_0x47e73f(0x156)]()),broadcast(_0x19dced['roomId'],{'type':_0x47e73f(0x12d),'clientId':_0x4b3564,'nickname':_0x19dced['nickname']}),broadcast(_0x19dced[_0x47e73f(0x139)],{'type':'participants-update','participants':Array[_0x47e73f(0x129)](_0x266807[_0x47e73f(0x164)][_0x47e73f(0x14c)]())}));}clients[_0x47e73f(0x116)](_0x4b3564);});}),setInterval(()=>{const _0x37bb19=_0xc3ae3d,_0x1d2ff4=Date[_0x37bb19(0x156)]();rooms['forEach']((_0xe86a10,_0x93f426)=>{const _0x2db081=_0x37bb19;0x0===_0xe86a10[_0x2db081(0x164)][_0x2db081(0x131)]&&_0xe86a10[_0x2db081(0x122)]&&_0x1d2ff4-_0xe86a10[_0x2db081(0x122)]>0x927c0&&(rooms['delete'](_0x93f426),console[_0x2db081(0x162)](_0x2db081(0x130)+_0x93f426+_0x2db081(0x13f)));});},0xea60);const PORT=process['env'][_0xc3ae3d(0x128)]||0xbb8;server[_0xc3ae3d(0x142)](PORT,()=>{console['log']('Server\x20running\x20on\x20http://localhost:'+PORT);});